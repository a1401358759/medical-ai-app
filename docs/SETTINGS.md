# AI模型设置功能

## 概述

医疗AI助手现在支持用户自定义AI模型和API密钥配置。用户可以在设置页面中选择偏好的AI模型，并配置相应的API密钥。

## 功能特性

### 支持的AI模型

1. **OpenAI GPT-4**
   - 模型ID: `openai`
   - 描述: OpenAI的GPT-4模型，提供强大的自然语言处理能力
   - 基础URL: `https://api.openai.com/v1`

2. **DeepSeek Chat**
   - 模型ID: `deepseek`
   - 描述: DeepSeek的聊天模型，支持中文对话
   - 基础URL: `https://api.deepseek.com/v1`

3. **Anthropic Claude**
   - 模型ID: `anthropic`
   - 描述: Anthropic的Claude模型，注重安全性和准确性
   - 基础URL: 无（使用官方API）

4. **Kimi (Moonshot)**
   - 模型ID: `kimi`
   - 描述: 通过Moonshot API访问的Kimi模型
   - 基础URL: `https://api.moonshot.cn/v1`

### 设置页面功能

1. **首选模型选择**
   - 用户可以选择偏好的AI模型
   - 支持可视化选择界面
   - 实时显示当前选择的模型

2. **API密钥配置**
   - 为每个模型配置独立的API密钥
   - 支持密码输入框，保护密钥安全
   - 显示密钥掩码，方便用户确认

3. **基础URL配置**
   - 支持自定义API基础URL
   - 适用于使用代理或自定义API端点的用户

## 使用方法

### 访问设置页面

1. 登录到医疗AI助手
2. 点击右上角用户头像
3. 在下拉菜单中选择"设置"
4. 进入设置页面

### 配置AI模型

1. **选择首选模型**
   - 在"首选AI模型"部分点击想要使用的模型
   - 选中的模型会显示蓝色边框和勾选图标

2. **配置API密钥**
   - 在"API密钥配置"部分找到对应的模型
   - 输入该模型的API密钥
   - 如果模型支持自定义基础URL，也可以配置

3. **保存设置**
   - 点击页面底部的"保存设置"按钮
   - 系统会显示保存成功或失败的提示

### 验证配置

配置完成后，用户可以在聊天页面测试AI回复，系统会自动使用配置的模型和API密钥。

## 技术实现

### 后端实现

1. **数据库模型**
   - 在User模型中添加了`settings`字段（JSON类型）
   - 存储用户的首选模型、API密钥和基础URL配置

2. **API端点**
   - `GET /api/users/settings` - 获取用户设置
   - `PUT /api/users/settings` - 更新用户设置
   - `GET /api/users/available-models` - 获取可用模型列表

3. **AI服务集成**
   - 修改了MultiAIService类，支持根据用户设置创建AI服务实例
   - 聊天API会根据用户设置选择对应的AI模型

### 前端实现

1. **设置页面组件**
   - 创建了`Settings.tsx`组件
   - 支持模型选择和API密钥配置
   - 提供友好的用户界面和交互反馈

2. **API服务**
   - 在`api.ts`中添加了设置相关的API调用方法
   - 支持获取和更新用户设置

3. **路由配置**
   - 在App.tsx中添加了设置页面路由
   - 在Layout组件中添加了设置菜单项

## 安全考虑

1. **API密钥保护**
   - 前端使用密码输入框隐藏API密钥
   - 显示密钥掩码，只显示前4位和后4位
   - 后端安全存储用户设置

2. **用户权限**
   - 设置功能需要用户登录
   - 用户只能访问和修改自己的设置

## 故障排除

### 常见问题

1. **设置保存失败**
   - 检查网络连接
   - 确认用户已登录
   - 查看浏览器控制台错误信息

2. **AI回复异常**
   - 检查API密钥是否正确
   - 确认模型配置是否正确
   - 查看后端日志获取详细错误信息

3. **模型不可用**
   - 确认API密钥有效
   - 检查网络连接
   - 验证基础URL配置

### 调试方法

1. **前端调试**
   - 打开浏览器开发者工具
   - 查看Network标签页的API请求
   - 检查Console标签页的错误信息

2. **后端调试**
   - 查看后端服务日志
   - 使用测试脚本验证API功能
   - 检查数据库中的用户设置

## 更新日志

- **v1.0.0**: 初始版本，支持基本的AI模型设置功能
- 支持4种主流AI模型
- 提供完整的设置界面
- 实现用户个性化配置
