# 修改对话名称功能

## 功能概述

本功能允许用户修改聊天会话的标题，提供更好的会话管理体验。

## 实现细节

### 后端实现

#### 1. 数据模型
- 使用现有的 `ChatSession` 模型
- 标题字段：`title` (String类型)

#### 2. API端点
- **PUT** `/api/chat/sessions/{session_id}`
- 请求体：`{"title": "新标题"}`
- 响应：更新后的会话对象

#### 3. 权限控制
- 用户只能修改自己创建的会话
- 需要有效的认证token

#### 4. 错误处理
- 404：会话不存在或不属于当前用户
- 401：认证失败
- 500：服务器内部错误

### 前端实现

#### 1. API调用
```typescript
// 在 api.ts 中添加
updateSession: (sessionId: number, title: string): Promise<ChatSession> =>
  api.put(`/chat/sessions/${sessionId}`, { title }).then(res => res.data),
```

#### 2. 状态管理
- `editingSessionId`: 当前正在编辑的会话ID
- `editingTitle`: 编辑中的标题内容
- `updatingSession`: 更新状态标志

#### 3. 用户交互
- **进入编辑模式**：点击会话标题或编辑按钮
- **保存**：按Enter键或点击保存按钮
- **取消**：按Escape键或点击取消按钮
- **自动保存**：失去焦点时自动保存

#### 4. UI特性
- 响应式设计，支持桌面端和移动端
- 悬停显示编辑按钮
- 加载状态指示器
- 键盘快捷键支持

## 使用方法

### 桌面端
1. 在左侧会话列表中，将鼠标悬停在会话标题上
2. 点击出现的编辑图标或直接点击标题
3. 输入新标题
4. 按Enter键或点击保存按钮完成编辑

### 移动端
1. 在会话列表中点击会话标题
2. 输入新标题
3. 点击保存按钮完成编辑

### 键盘快捷键
- **Enter**: 保存更改
- **Escape**: 取消编辑

## 技术特性

### 1. 实时更新
- 编辑完成后立即更新UI
- 同步更新会话列表和当前会话

### 2. 错误处理
- 网络错误提示
- 验证失败处理
- 用户友好的错误消息

### 3. 性能优化
- 防抖处理避免频繁请求
- 本地状态管理减少服务器请求

### 4. 用户体验
- 平滑的动画过渡
- 直观的视觉反馈
- 无障碍访问支持

## 测试

### 手动测试
1. 启动后端服务：`python -m uvicorn main:app --reload`
2. 启动前端服务：`npm start`
3. 登录并创建或选择一个会话
4. 尝试编辑会话标题

### 自动化测试
运行测试脚本：
```bash
cd backend
python test_update_session.py
```

## 注意事项

1. **权限验证**：确保用户只能编辑自己的会话
2. **输入验证**：标题不能为空
3. **并发处理**：避免同时编辑多个会话
4. **数据一致性**：确保前后端数据同步

## 未来改进

1. **批量重命名**：支持同时编辑多个会话
2. **历史记录**：记录标题修改历史
3. **智能建议**：基于对话内容自动生成标题
4. **快捷键**：更多键盘快捷键支持
